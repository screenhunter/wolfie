{"version":3,"sources":["/home/havvy/tennu/tennu/src/lib/client.js"],"names":["lodash","require","format","defaultFactoryConfiguration","Socket","defaultClientConfiguration","undefined","Client","config","dependencies","nick","user","Error","client","Object","create","prototype","_config","freeze","defaults","di","_logger","Logger","_socket","IrcSocket","NetSocket","_messageHandler","MessageHandler","_nickname","NicknameTracker","nickname","_outputSocket","IrcOutputSocket","commandHandler","CommandHandler","_subscriber","BiSubscriber","on","privmsg","parse","_plugins","Plugins","addHook","module","handlers","note","use","__dirname","plugins","process","cwd","out","events","connected","getPlugin","setState","param","connect","debug","warn","isEdgeState","error","getState","start","disconnect","end","say","apply","arguments","act","ctcp","part","quit","join","userhost","whois","mode","raw","rawf","once","off","getRole","initializePlugin","initialize","isPluginInitializable","isInitializable","info","notice","crit","alert","emerg","log","level","args","Array","slice","call","die","cause","_end","exports"],"mappings":"AAAA,MAAMA,MAAA,GAASC,OAAA,CAAQ,QAAR,CAAf;AACA,MAAMC,MAAA,GAASD,OAAA,CAAQ,MAAR,EAAgBC,MAA/B,CADA;AAWA,MAAMC,2BAAA,GAA8B;AAAA,QAChC,aAAcF,OAAA,CAAQ,KAAR,EAAeG,MADG;AAAA,QAEhC,aAAcH,OAAA,CAAQ,YAAR,CAFkB;AAAA,QAGhC,mBAAoBA,OAAA,CAAQ,oBAAR,CAHY;AAAA,QAIhC,kBAAmBA,OAAA,CAAQ,sBAAR,CAJa;AAAA,QAKhC,kBAAmBA,OAAA,CAAQ,sBAAR,CALa;AAAA,QAMhC,WAAYA,OAAA,CAAQ,eAAR,CANoB;AAAA,QAOhC,gBAAiBA,OAAA,CAAQ,mBAAR,CAPe;AAAA,QAQhC,UAAUA,OAAA,CAAQ,kBAAR,CARsB;AAAA,QAShC,mBAAmBA,OAAA,CAAQ,uBAAR,CATa;AAAA,KAApC,CAXA;AAuBA,MAAMI,0BAAA,GAA6B;AAAA,QAE/B,UAAUC,SAFqB;AAAA,QAG/B,QAAQ,IAHuB;AAAA,QAI/B,QAAQA,SAJuB;AAAA,QAK/B,gBAAgBA,SALe;AAAA,QAM/B,UAAU,KANqB;AAAA,QAO/B,YAAYA,SAPmB;AAAA,QAQ/B,SAAS,KARsB;AAAA,QAS/B,YAAY,UATmB;AAAA,QAU/B,YAAY,OAVmB;AAAA,QAW/B,YAAY,aAXmB;AAAA,QAc/B,YAAY,EAdmB;AAAA,QAe/B,YAAY,UAfmB;AAAA,QAgB/B,iBAAiBA,SAhBc;AAAA,QAiB/B,WAAW,EAjBoB;AAAA,QAkB/B,mBAAmB,GAlBY;AAAA,QAmB/B,gBAAgB,KAnBe;AAAA,KAAnC,CAvBA;AAsDC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAMC,MAAA,GAAS,UAAUC,MAAV,EAAkBC,YAAlB,EAAgC;AAAA,IAC5C,IAAID,MAAA,CAAOE,IAAP,IAAeF,MAAA,CAAOG,IAA1B,EAAgC;AAAA,QAC5B,MAAM,IAAIC,KAAJ,CAAU,0FAAV,CAAN,CAD4B;AAAA,KADY;AAAA,IAK5C,MAAMC,MAAA,GAASC,MAAA,CAAOC,MAAP,CAAcR,MAAA,CAAOS,SAArB,CAAf,CAL4C;AAAA,IAQ5C;AAAA,IAAAH,MAAA,CAAOI,OAAP,GAAiBT,MAAA,GAASM,MAAA,CAAOI,MAAP,CAAclB,MAAA,CAAOmB,QAAP,CAAgB,EAAhB,EAAoBX,MAApB,EAA4BH,0BAA5B,CAAd,CAA1B,CAR4C;AAAA,IAS5Ce,EAAA,GAAKpB,MAAA,CAAOmB,QAAP,CAAgB,EAAhB,EAAoBV,YAAA,IAAgB,EAApC,EAAwCN,2BAAxC,CAAL,CAT4C;AAAA,IAa5C;AAAA;AAAA,IAAAU,MAAA,CAAOQ,OAAP,GAAiB,IAAID,EAAA,CAAGE,MAAP,EAAjB,CAb4C;AAAA,IAgB5C;AAAA,IAAAT,MAAA,CAAOU,OAAP,GAAiB,IAAIH,EAAA,CAAGI,SAAP,CAAiBhB,MAAjB,EAAyBY,EAAA,CAAGK,SAA5B,CAAjB,CAhB4C;AAAA,IAqB5C;AAAA;AAAA;AAAA,IAAAZ,MAAA,CAAOa,eAAP,GAAyB,IAAIN,EAAA,CAAGO,cAAP,CAAsBd,MAAtB,EAA8BA,MAAA,CAAOQ,OAArC,EAA8CR,MAAA,CAAOU,OAArD,CAAzB,CArB4C;AAAA,IA0B5C;AAAA;AAAA;AAAA,IAAAV,MAAA,CAAOe,SAAP,GAAmBR,EAAA,CAAGS,eAAH,CAAmBrB,MAAA,CAAOsB,QAA1B,EAAoCjB,MAAA,CAAOa,eAA3C,CAAnB,CA1B4C;AAAA,IA6B5C;AAAA,IAAAb,MAAA,CAAOkB,aAAP,GAAuB,IAAIX,EAAA,CAAGY,eAAP,CAAuBnB,MAAA,CAAOU,OAA9B,EAAuCV,MAAA,CAAOa,eAA9C,EAA+Db,MAAA,CAAOe,SAAtE,EAAiFf,MAAA,CAAOQ,OAAxF,CAAvB,CA7B4C;AAAA,IAkC5C;AAAA;AAAA;AAAA,UAAMY,cAAA,GAAiB,IAAIb,EAAA,CAAGc,cAAP,CAAsB1B,MAAtB,EAA8BK,MAA9B,EAAsCA,MAAA,CAAOe,SAA7C,EAAwDf,MAAA,CAAOQ,OAA/D,CAAvB,CAlC4C;AAAA,IAuC5C;AAAA;AAAA;AAAA,IAAAR,MAAA,CAAOsB,WAAP,GAAqB,IAAIf,EAAA,CAAGgB,YAAP,CAAoBvB,MAAA,CAAOa,eAA3B,EAA4CO,cAA5C,CAArB,CAvC4C;AAAA,IAwC5CpB,MAAA,CAAOsB,WAAP,CAAmBE,EAAnB,CAAsB,SAAtB,EAAiC,UAAUC,OAAV,EAAmB;AAAA,QAAEL,cAAA,CAAeM,KAAf,CAAqBD,OAArB,EAAF;AAAA,KAApD,EAxC4C;AAAA,IA2C5C;AAAA,IAAAzB,MAAA,CAAO2B,QAAP,GAAkB,IAAIpB,EAAA,CAAGqB,OAAP,CAAe,OAAf,EAAwB5B,MAAxB,CAAlB,CA3C4C;AAAA,IA4C5CA,MAAA,CAAO2B,QAAP,CAAgBE,OAAhB,CAAwB,UAAxB,EAAoC,UAAUC,MAAV,EAAkBC,QAAlB,EAA4B;AAAA,QAC5D/B,MAAA,CAAOsB,WAAP,CAAmBE,EAAnB,CAAsBO,QAAtB,EAD4D;AAAA,KAAhE,EA5C4C;AAAA,IA+C5C/B,MAAA,CAAOgC,IAAP,CAAY,OAAZ,EAAqB,yBAArB,EA/C4C;AAAA,IAgD5ChC,MAAA,CAAO2B,QAAP,CAAgBM,GAAhB,CAAoB;AAAA,QAAC,WAAD;AAAA,QAAc,QAAd;AAAA,QAAwB,MAAxB;AAAA,QAAgC,MAAhC;AAAA,QAAwC,SAAxC;AAAA,QAAmD,SAAnD;AAAA,KAApB,EAAmFC,SAAnF,EAhD4C;AAAA,IAiD5ClC,MAAA,CAAOgC,IAAP,CAAY,OAAZ,EAAqB,sBAArB,EAjD4C;AAAA,IAkD5ChC,MAAA,CAAO2B,QAAP,CAAgBM,GAAhB,CAAoBtC,MAAA,CAAOwC,OAAP,IAAkB,EAAtC,EAA0CC,OAAA,CAAQC,GAAR,EAA1C,EAlD4C;AAAA,IAqD5CrC,MAAA,CAAOsC,GAAP,GAAatC,MAAA,CAAOkB,aAApB,CArD4C;AAAA,IAsD5ClB,MAAA,CAAOuC,MAAP,GAAgBvC,MAAA,CAAOsB,WAAvB,CAtD4C;AAAA,IAuD5CtB,MAAA,CAAOmC,OAAP,GAAiBnC,MAAA,CAAO2B,QAAxB,CAvD4C;AAAA,IAwD5C3B,MAAA,CAAOiB,QAAP,GAAkBjB,MAAA,CAAOe,SAAzB,CAxD4C;AAAA,IA0D5Cf,MAAA,CAAOwC,SAAP,GAAmB,KAAnB,CA1D4C;AAAA,IA4D5CxC,MAAA,CAAOgC,IAAP,CAAY,OAAZ,EAAqB,iBAArB,EA5D4C;AAAA,IA8D5ChC,MAAA,CAAO2B,QAAP,CAAgBc,SAAhB,CAA0B,WAA1B,EAAuCC,QAAvC,CAAgD,aAAhD,EA9D4C;AAAA,IA+D5C,OAAO1C,MAAP,CA/D4C;AAAA,CAA/C,CAtDD;AA0HA;AAAAN,MAAA,CAAOS,SAAP,CAAiBR,MAAjB,GAA0B,UAAUgD,KAAV,EAAiB;AAAA,IACvC,OAAO,KAAKvC,OAAL,CAAauC,KAAb,CAAP,CADuC;AAAA,CAA3C,CA1HA;AAgIA;AAAA,MAAMC,OAAA,GAAU,YAAY;AAAA,IACxB,KAAKC,KAAL,CAAW,OAAX,EAAoB,oBAApB,EADwB;AAAA,IAGxB,IAAI,KAAKL,SAAT,EAAoB;AAAA,QAChB,KAAKM,IAAL,CAAU,OAAV,EAAmB,4DAAnB,EADgB;AAAA,QAEhB,OAFgB;AAAA,KAHI;AAAA,IAQxB,IAAI,KAAKL,SAAL,CAAe,WAAf,EAA4BM,WAA5B,EAAJ,EAA+C;AAAA,QAC3C,KAAKC,KAAL,CAAW,OAAX,EAAoB3D,MAAA,CAAO,iDAAP,EAA0D,KAAKoD,SAAL,CAAe,WAAf,EAA4BQ,QAA5B,EAA1D,CAApB,EAD2C;AAAA,QAE3C,OAF2C;AAAA,KARvB;AAAA,IAaxB,KAAKvC,OAAL,CAAakC,OAAb,GAbwB;AAAA,IAcxB,KAAKJ,SAAL,GAAiB,IAAjB,CAdwB;AAAA,IAexB,KAAKK,KAAL,CAAW,OAAX,EAAoB,WAApB,EAfwB;AAAA,IAgBxB,OAAO,IAAP,CAhBwB;AAAA,CAA5B,CAhIA;AAmJAnD,MAAA,CAAOS,SAAP,CAAiByC,OAAjB,GAA2BA,OAA3B,CAnJA;AAoJAlD,MAAA,CAAOS,SAAP,CAAiB+C,KAAjB,GAAyBN,OAAzB,CApJA;AAsJA,MAAMO,UAAA,GAAa,YAAY;AAAA,IAC3B,KAAKN,KAAL,CAAW,OAAX,EAAoB,uBAApB,EAD2B;AAAA,IAG3B,IAAI,CAAC,KAAKL,SAAV,EAAqB;AAAA,QACjB,KAAKM,IAAL,CAAU,OAAV,EAAmB,8DAAnB,EADiB;AAAA,QAEjB,OAAO,IAAP,CAFiB;AAAA,KAHM;AAAA,IAQ3B,KAAKpC,OAAL,CAAa0C,GAAb,GAR2B;AAAA,IAS3B,KAAKZ,SAAL,GAAiB,KAAjB,CAT2B;AAAA,IAU3B,KAAKK,KAAL,CAAW,OAAX,EAAoB,cAApB,EAV2B;AAAA,IAW3B,OAAO,IAAP,CAX2B;AAAA,CAA/B,CAtJA;AAoKAnD,MAAA,CAAOS,SAAP,CAAiBgD,UAAjB,GAA8BA,UAA9B,CApKA;AAqKAzD,MAAA,CAAOS,SAAP,CAAiBiD,GAAjB,GAAuBD,UAAvB,CArKA;AAyKA;AAAAzD,MAAA,CAAOS,SAAP,CAAiBkD,GAAjB,GApKQ,YAAY;AAAA,IACR,OAAQ,KAmK+BnC,aAnK/B,CAmK6CmC,GAnK7C,CAA6BC,KAA7B,CAAoC,KAmKLpC,aAnK/B,EAAuDqC,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAoKpB,CAzKA;AA0KA7D,MAAA,CAAOS,SAAP,CAAiBqD,GAAjB,GArKQ,YAAY;AAAA,IACR,OAAQ,KAoK+BtC,aApK/B,CAoK6CsC,GApK7C,CAA6BF,KAA7B,CAAoC,KAoKLpC,aApK/B,EAAuDqC,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAqKpB,CA1KA;AA6KA;AAAA;AAAA7D,MAAA,CAAOS,SAAP,CAAiBsD,IAAjB,GAxKQ,YAAY;AAAA,IACR,OAAQ,KAuK+BvC,aAvK/B,CAuK6CuC,IAvK7C,CAA6BH,KAA7B,CAAoC,KAuKLpC,aAvK/B,EAAuDqC,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAwKpB,CA7KA;AA8KA7D,MAAA,CAAOS,SAAP,CAAiBuD,IAAjB,GAzKQ,YAAY;AAAA,IACR,OAAQ,KAwK+BxC,aAxK/B,CAwK6CwC,IAxK7C,CAA6BJ,KAA7B,CAAoC,KAwKLpC,aAxK/B,EAAuDqC,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAyKpB,CA9KA;AA+KA7D,MAAA,CAAOS,SAAP,CAAiBwD,IAAjB,GA1KQ,YAAY;AAAA,IACR,OAAQ,KAyK+BzC,aAzK/B,CAyK6CyC,IAzK7C,CAA6BL,KAA7B,CAAoC,KAyKLpC,aAzK/B,EAAuDqC,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CA0KpB,CA/KA;AAgLA7D,MAAA,CAAOS,SAAP,CAAiByD,IAAjB,GA3KQ,YAAY;AAAA,IACR,OAAQ,KA0K+B1C,aA1K/B,CA0K6C0C,IA1K7C,CAA6BN,KAA7B,CAAoC,KA0KLpC,aA1K/B,EAAuDqC,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CA2KpB,CAhLA;AAiLA7D,MAAA,CAAOS,SAAP,CAAiB0D,QAAjB,GA5KQ,YAAY;AAAA,IACR,OAAQ,KA2K+B3C,aA3K/B,CA2K6C2C,QA3K7C,CAA6BP,KAA7B,CAAoC,KA2KLpC,aA3K/B,EAAuDqC,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CA4KpB,CAjLA;AAkLA7D,MAAA,CAAOS,SAAP,CAAiB2D,KAAjB,GA7KQ,YAAY;AAAA,IACR,OAAQ,KA4K+B5C,aA5K/B,CA4K6C4C,KA5K7C,CAA6BR,KAA7B,CAAoC,KA4KLpC,aA5K/B,EAAuDqC,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CA6KpB,CAlLA;AAmLA7D,MAAA,CAAOS,SAAP,CAAiBN,IAAjB,GA9KQ,YAAY;AAAA,IACR,OAAQ,KA6K+BqB,aA7K/B,CA6K6CrB,IA7K7C,CAA6ByD,KAA7B,CAAoC,KA6KLpC,aA7K/B,EAAuDqC,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CA8KpB,CAnLA;AAoLA7D,MAAA,CAAOS,SAAP,CAAiB4D,IAAjB,GA/KQ,YAAY;AAAA,IACR,OAAQ,KA8K+B7C,aA9K/B,CA8K6C6C,IA9K7C,CAA6BT,KAA7B,CAAoC,KA8KLpC,aA9K/B,EAAuDqC,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CA+KpB,CApLA;AAqLA7D,MAAA,CAAOS,SAAP,CAAiB6D,GAAjB,GAhLQ,YAAY;AAAA,IACR,OAAQ,KA+K+B9C,aA/K/B,CA+K6C8C,GA/K7C,CAA6BV,KAA7B,CAAoC,KA+KLpC,aA/K/B,EAAuDqC,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAgLpB,CArLA;AAsLA7D,MAAA,CAAOS,SAAP,CAAiB8D,IAAjB,GAjLQ,YAAY;AAAA,IACR,OAAQ,KAgL+B/C,aAhL/B,CAgL6C+C,IAhL7C,CAA6BX,KAA7B,CAAoC,KAgLLpC,aAhL/B,EAAuDqC,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAiLpB,CAtLA;AAyLA;AAAA7D,MAAA,CAAOS,SAAP,CAAiBqB,EAAjB,GApLQ,YAAY;AAAA,IACR,OAAQ,KAmL+BF,WAnL/B,CAmL2CE,EAnL3C,CAA6B8B,KAA7B,CAAoC,KAmLLhC,WAnL/B,EAAuDiC,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAoLpB,CAzLA;AA0LA7D,MAAA,CAAOS,SAAP,CAAiB+D,IAAjB,GArLQ,YAAY;AAAA,IACR,OAAQ,KAoL+B5C,WApL/B,CAoL2C4C,IApL3C,CAA6BZ,KAA7B,CAAoC,KAoLLhC,WApL/B,EAAuDiC,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAqLpB,CA1LA;AA2LA7D,MAAA,CAAOS,SAAP,CAAiBgE,GAAjB,GAtLQ,YAAY;AAAA,IACR,OAAQ,KAqL+B7C,WArL/B,CAqL2C6C,GArL3C,CAA6Bb,KAA7B,CAAoC,KAqLLhC,WArL/B,EAAuDiC,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAsLpB,CA3LA;AA8LA;AAAA7D,MAAA,CAAOS,SAAP,CAAiB8B,GAAjB,GAzLQ,YAAY;AAAA,IACR,OAAQ,KAwL+BN,QAxL/B,CAwLwCM,GAxLxC,CAA6BqB,KAA7B,CAAoC,KAwLL3B,QAxL/B,EAAuD4B,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAyLpB,CA9LA;AA+LA7D,MAAA,CAAOS,SAAP,CAAiBsC,SAAjB,GA1LQ,YAAY;AAAA,IACR,OAAQ,KAyL+Bd,QAzL/B,CAyLwCc,SAzLxC,CAA6Ba,KAA7B,CAAoC,KAyLL3B,QAzL/B,EAAuD4B,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CA0LpB,CA/LA;AAgMA7D,MAAA,CAAOS,SAAP,CAAiBiE,OAAjB,GA3LQ,YAAY;AAAA,IACR,OAAQ,KA0L+BzC,QA1L/B,CA0LwCyC,OA1LxC,CAA6Bd,KAA7B,CAAoC,KA0LL3B,QA1L/B,EAAuD4B,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CA2LpB,CAhMA;AAiMA7D,MAAA,CAAOS,SAAP,CAAiBkE,gBAAjB,GA5LQ,YAAY;AAAA,IACR,OAAQ,KA2L+B1C,QA3L/B,CA2LwC2C,UA3LxC,CAA6BhB,KAA7B,CAAoC,KA2LL3B,QA3L/B,EAAuD4B,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CA4LpB,CAjMA;AAkMA7D,MAAA,CAAOS,SAAP,CAAiBoE,qBAAjB,GA7LQ,YAAY;AAAA,IACR,OAAQ,KA4L+B5C,QA5L/B,CA4LwC6C,eA5LxC,CAA6BlB,KAA7B,CAAoC,KA4LL3B,QA5L/B,EAAuD4B,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CA6LpB,CAlMA;AAmMA7D,MAAA,CAAOS,SAAP,CAAiB0B,OAAjB,GA9LQ,YAAY;AAAA,IACR,OAAQ,KA6L+BF,QA7L/B,CA6LwCE,OA7LxC,CAA6ByB,KAA7B,CAAoC,KA6LL3B,QA7L/B,EAAuD4B,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CA8LpB,CAnMA;AAsMA;AAAA7D,MAAA,CAAOS,SAAP,CAAiB0C,KAAjB,GAjMQ,YAAY;AAAA,IACR,OAAQ,KAgM+BrC,OAhM/B,CAgMuCqC,KAhMvC,CAA6BS,KAA7B,CAAoC,KAgML9C,OAhM/B,EAAuD+C,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAiMpB,CAtMA;AAuMA7D,MAAA,CAAOS,SAAP,CAAiBsE,IAAjB,GAlMQ,YAAY;AAAA,IACR,OAAQ,KAiM+BjE,OAjM/B,CAiMuCiE,IAjMvC,CAA6BnB,KAA7B,CAAoC,KAiML9C,OAjM/B,EAAuD+C,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAkMpB,CAvMA;AAyMA;AAAA7D,MAAA,CAAOS,SAAP,CAAiBuE,MAAjB,GApMQ,YAAY;AAAA,IACR,OAAQ,KAmM+BlE,OAnM/B,CAmMuCkE,MAnMvC,CAA6BpB,KAA7B,CAAoC,KAmML9C,OAnM/B,EAAuD+C,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAoMpB,CAzMA;AA0MA7D,MAAA,CAAOS,SAAP,CAAiB6B,IAAjB,GArMQ,YAAY;AAAA,IACR,OAAQ,KAoM+BxB,OApM/B,CAoMuCkE,MApMvC,CAA6BpB,KAA7B,CAAoC,KAoML9C,OApM/B,EAAuD+C,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAqMpB,CA1MA;AA2MA7D,MAAA,CAAOS,SAAP,CAAiB2C,IAAjB,GAtMQ,YAAY;AAAA,IACR,OAAQ,KAqM+BtC,OArM/B,CAqMuCsC,IArMvC,CAA6BQ,KAA7B,CAAoC,KAqML9C,OArM/B,EAAuD+C,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAsMpB,CA3MA;AA4MA7D,MAAA,CAAOS,SAAP,CAAiB6C,KAAjB,GAvMQ,YAAY;AAAA,IACR,OAAQ,KAsM+BxC,OAtM/B,CAsMuCwC,KAtMvC,CAA6BM,KAA7B,CAAoC,KAsML9C,OAtM/B,EAAuD+C,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAuMpB,CA5MA;AA6MA7D,MAAA,CAAOS,SAAP,CAAiBwE,IAAjB,GAxMQ,YAAY;AAAA,IACR,OAAQ,KAuM+BnE,OAvM/B,CAuMuCmE,IAvMvC,CAA6BrB,KAA7B,CAAoC,KAuML9C,OAvM/B,EAAuD+C,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAwMpB,CA7MA;AA8MA7D,MAAA,CAAOS,SAAP,CAAiByE,KAAjB,GAzMQ,YAAY;AAAA,IACR,OAAQ,KAwM+BpE,OAxM/B,CAwMuCoE,KAxMvC,CAA6BtB,KAA7B,CAAoC,KAwML9C,OAxM/B,EAAuD+C,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CAyMpB,CA9MA;AA+MA7D,MAAA,CAAOS,SAAP,CAAiB0E,KAAjB,GA1MQ,YAAY;AAAA,IACR,OAAQ,KAyM+BrE,OAzM/B,CAyMuCqE,KAzMvC,CAA6BvB,KAA7B,CAAoC,KAyML9C,OAzM/B,EAAuD+C,SAAvD,CAAD,IAAuE,IAA9E,CADQ;AAAA,CA0MpB,CA/MA;AAiNA7D,MAAA,CAAOS,SAAP,CAAiB2E,GAAjB,GAAuB,UAAUC,KAAV,EAAiB;AAAA,IACpC,MAAMC,IAAA,GAAOC,KAAA,CAAM9E,SAAN,CAAgB+E,KAAhB,CAAsBC,IAAtB,CAA2B5B,SAA3B,EAAsC,CAAtC,CAAb,CADoC;AAAA,IAEpC,KAAKwB,KAAL,EAAYzB,KAAZ,CAAkB,IAAlB,EAAwB0B,IAAxB,EAFoC;AAAA,IAGpC,OAAO,IAAP,CAHoC;AAAA,CAAxC,CAjNA;AAuNAtF,MAAA,CAAOS,SAAP,CAAiBiF,GAAjB,GAAuB,UAAUC,KAAV,EAAiB;AAAA,IACpC,KAAK5C,SAAL,CAAe,UAAf,EAA2B2C,GAA3B,CAA+B,IAA/B,EAAqC;AAAA,QAAC,kBAAD;AAAA,QAAqBC,KAArB;AAAA,KAArC,EADoC;AAAA,IAEpC,OAAO,IAAP,CAFoC;AAAA,CAAxC,CAvNA;AA4NA3F,MAAA,CAAOS,SAAP,CAAiBmF,IAAjB,GAAwB,YAAY;AAAA,IAChC,KAAK5E,OAAL,CAAa0C,GAAb,GADgC;AAAA,IAEhC,KAAKZ,SAAL,GAAiB,KAAjB,CAFgC;AAAA,IAGhC,KAAKK,KAAL,CAAW,OAAX,EAAoB,cAApB,EAHgC;AAAA,CAApC,CA5NA;AAmOA;AAAAf,MAAA,CAAOyD,OAAP,GAAiB7F,MAAjB","file":"client.js","sourcesContent":["const lodash = require(\"lodash\");\nconst format = require(\"util\").format;\n\nmacro delegate {\n    rule { $property:ident $method:ident } => {\n        function () {\n            return (this . $property . $method . apply (this . $property , arguments)) || this;\n        }\n    }\n}\n\nconst defaultFactoryConfiguration = {\n    \"NetSocket\" : require(\"net\").Socket,\n    \"IrcSocket\" : require(\"irc-socket\"),\n    \"IrcOutputSocket\" : require(\"./output-socket.js\"),\n    \"MessageHandler\" : require(\"./message-handler.js\"),\n    \"CommandHandler\" : require(\"./command-handler.js\"),\n    \"Plugins\" : require(\"tennu-plugins\"),\n    \"BiSubscriber\" : require(\"./bisubscriber.js\"),\n    \"Logger\": require(\"./null-logger.js\"),\n    \"NicknameTracker\": require(\"./nickname-tracker.js\")\n};\n\nconst defaultClientConfiguration = {\n    // IrcSocket Config\n    \"server\": undefined,\n    \"port\": 6667,\n    \"ipv6\": undefined,\n    \"localAddress\": undefined,\n    \"secure\": false,\n    \"password\": undefined,\n    \"capab\": false,\n    \"nickname\": \"tennubot\",\n    \"username\": \"tennu\",\n    \"realname\": \"tennu 0.9.x\",\n\n    // Tennu Config\n    \"channels\": [],\n    \"nickserv\": \"nickserv\",\n    \"auth-password\": undefined,\n    \"plugins\": [],\n    \"command-trigger\": \"!\",\n    \"disable-help\": false\n};\n\n/** Fields\n * _config\n * _socket\n * _logger\n * out      (_outputSocket)\n * events   (_subscriber)\n * plugins  (_plugins)\n * nickname (_nickname)\n */\n const Client = function (config, dependencies) {\n    if (config.nick || config.user) {\n        throw new Error(\"Please use \\\"nickname\\\" and \\\"username\\\" instead of \\\"nick\\\" and \\\"user\\\" in your configuration.\");\n    }\n\n    const client = Object.create(Client.prototype);\n\n    // Parse the configuration object. Make it immutable.\n    client._config = config = Object.freeze(lodash.defaults({}, config, defaultClientConfiguration));\n    di = lodash.defaults({}, dependencies || {}, defaultFactoryConfiguration);\n\n    // Create a logger.\n    // Default logger is a bunch of NOOPs.\n    client._logger = new di.Logger();\n\n    // The socket reads and sends messages from/to the IRC server.\n    client._socket = new di.IrcSocket(config, di.NetSocket);\n\n    // Create the listener to the socket.\n    // This listener will parse the raw messages of the socket, and\n    // emits specific events to listen to.\n    client._messageHandler = new di.MessageHandler(client, client._logger, client._socket);\n\n    // Create the object that tracks the nickname of the client.\n    // Because this object is a function, it is expected that\n    // the factory function does not use `this`.\n    client._nickname = di.NicknameTracker(config.nickname, client._messageHandler);\n\n    // The output socket wraps the `raw` method of the client._socket.\n    client._outputSocket = new di.IrcOutputSocket(client._socket, client._messageHandler, client._nickname, client._logger);\n\n    // Create the listener to private messages from the IRCMessageEmitter\n    // The commander will parse these private messages for commands, and\n    // emit those commands, also parsed.\n    const commandHandler = new di.CommandHandler(config, client, client._nickname, client._logger);\n\n    // The subscriber handles event subscriptions to the Client object,\n    // determining whether they should be handled by the IrcMessageEmitter\n    // or the Command Handler.\n    client._subscriber = new di.BiSubscriber(client._messageHandler, commandHandler);\n    client._subscriber.on(\"privmsg\", function (privmsg) { commandHandler.parse(privmsg); });\n\n    // And finally, the plugin system.\n    client._plugins = new di.Plugins(\"tennu\", client);\n    client._plugins.addHook(\"handlers\", function (module, handlers) {\n        client._subscriber.on(handlers);\n    });\n    client.note(\"Tennu\", \"Loading default plugins\");\n    client._plugins.use([\"lifecycle\", \"server\", \"help\", \"user\", \"channel\", \"startup\"], __dirname);\n    client.note(\"Tennu\", \"Loading your plugins\");\n    client._plugins.use(config.plugins || [], process.cwd());\n\n\n    client.out = client._outputSocket;\n    client.events = client._subscriber;\n    client.plugins = client._plugins;\n    client.nickname = client._nickname;\n\n    client.connected = false;\n\n    client.note(\"Tennu\", \"Client created.\");\n\n    client._plugins.getPlugin(\"lifecycle\").setState(\"initialized\");\n    return client;\n};\n\n// implements ConfigurationStorage\n\nClient.prototype.config = function (param) {\n    return this._config[param];\n};\n\n// implements Runnable ;)\n\nconst connect = function () {\n    this.debug(\"Tennu\", \"Trying to connect.\");\n\n    if (this.connected) {\n        this.warn(\"Tennu\", \"Attempted to start Tennu Client that already is connected.\");\n        return;\n    }\n\n    if (this.getPlugin(\"lifecycle\").isEdgeState()) {\n        this.error(\"Tennu\", format(\"Cannot start Tennu Client when in %s condition.\", this.getPlugin(\"lifecycle\").getState()));\n        return;\n    }\n\n    this._socket.connect();\n    this.connected = true;\n    this.debug(\"Tennu\", \"Connected\");\n    return this;\n}\n\nClient.prototype.connect = connect;\nClient.prototype.start = connect;\n\nconst disconnect = function () {\n    this.debug(\"Tennu\", \"Trying to disconnect.\");\n\n    if (!this.connected) {\n        this.warn(\"Tennu\", \"Attempted to end Tennu Client that already is not connected.\");\n        return this;\n    }\n\n    this._socket.end();\n    this.connected = false;\n    this.debug(\"Tennu\", \"Disconnected\");\n    return this;\n};\n\nClient.prototype.disconnect = disconnect;\nClient.prototype.end = disconnect;\n\n// implements IRC Output Socket\n\nClient.prototype.say                    = delegate _outputSocket say;\nClient.prototype.act                    = delegate _outputSocket act;\n// CONFLICT!\n// Client.prototype.notice                 = delegate _outputSocket notice;\nClient.prototype.ctcp                   = delegate _outputSocket ctcp;\nClient.prototype.part                   = delegate _outputSocket part;\nClient.prototype.quit                   = delegate _outputSocket quit;\nClient.prototype.join                   = delegate _outputSocket join;\nClient.prototype.userhost               = delegate _outputSocket userhost;\nClient.prototype.whois                  = delegate _outputSocket whois;\nClient.prototype.nick                   = delegate _outputSocket nick;\nClient.prototype.mode                   = delegate _outputSocket mode;\nClient.prototype.raw                    = delegate _outputSocket raw;\nClient.prototype.rawf                   = delegate _outputSocket rawf;\n\n// implements BiSubscriber\nClient.prototype.on                     = delegate _subscriber on;\nClient.prototype.once                   = delegate _subscriber once;\nClient.prototype.off                    = delegate _subscriber off;\n\n// implements ModuleSystem\nClient.prototype.use                    = delegate _plugins use;\nClient.prototype.getPlugin              = delegate _plugins getPlugin;\nClient.prototype.getRole                = delegate _plugins getRole;\nClient.prototype.initializePlugin       = delegate _plugins initialize;\nClient.prototype.isPluginInitializable  = delegate _plugins isInitializable;\nClient.prototype.addHook                = delegate _plugins addHook;\n\n// implements Logger\nClient.prototype.debug                  = delegate _logger debug;\nClient.prototype.info                   = delegate _logger info;\n// CONFLICT!\nClient.prototype.notice                 = delegate _logger notice;\nClient.prototype.note                   = delegate _logger notice;\nClient.prototype.warn                   = delegate _logger warn;\nClient.prototype.error                  = delegate _logger error;\nClient.prototype.crit                   = delegate _logger crit;\nClient.prototype.alert                  = delegate _logger alert;\nClient.prototype.emerg                  = delegate _logger emerg;\n\nClient.prototype.log = function (level) {\n    const args = Array.prototype.slice.call(arguments, 1);\n    this[level].apply(this, args);\n    return this;\n};\n\nClient.prototype.die = function (cause) {\n    this.getPlugin(\"lifetime\").die(this, [\"external request\", cause]);\n    return this;\n};\n\nClient.prototype._end = function () {\n    this._socket.end();\n    this.connected = false;\n    this.debug(\"Tennu\", \"Disconnected\");\n};\n\n// Export the factory.\nmodule.exports = Client;"],"sourceRoot":"/source/"}