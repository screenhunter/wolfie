{"version":3,"sources":["/home/havvy/tennu/tennu/src/plugin/channel.sjs"],"names":["Promise","require","module","exports","init","client","imports","isIdentifiedAs","nickname","accountname","debug","toLowerCase","resolve","reject","timeout","setTimeout","unregister","error","Error","fornick","fn","reply","off","handlers","clearTimeout","result","onLoggedIn","identifiedas","onRegNick","onWhoisEnd","onError","on","setImmediate","whois"],"mappings":"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","file":"user.js","sourcesContent":["/*\n\nvar SSet = require(\"simplesets\").Set;\n\nvar isSelf = function (nrc, nick) {\n    return nrc.getNick() === nick;\n};\n\nvar channels = {};\n\nvar Channel = function (name) {\n    this.name = name;\n    this.users = new SSet();\n};\n\nChannel.prototype.addUser = function (user) {\n    this.users.add(user);\n};\n\nChannel.prototype.removeUser = function (user) {\n    this.users.remove(user);\n};\n\nvar removeUserChannel = function (user) {\n    channels[channel].removeUser(user);\n};\n\nvar selfPart = function (channel) {\n    channels[channel];\n};\n\nvar selfJoin = function (channel) {\n    channels[channel] = new Channel(channel);\n};\n\n/**\n * Responds to the 353 raw numeric, which is sent when joining a channel.\n * The Message object handles adding users and channel automatically, so\n * there really isn't any work that has to be done here other than actually\n * adding the channels to the users.\n *//*\nvar namesHandler = function (msg) {\n    msg.users.forEach(function (user) {\n        addChannelToUser(msg.channel, user);\n    });\n};\n\nvar onleave = function () {\n    var self = {\n        part: selfPart,\n        quit: function () {},\n        join: selfJoin\n    };\n\n    var user = {\n        part: removeUserChannel,\n        quit: userQuit,\n        join: addUserChannel\n    };\n\n    return function (msg) {\n        if (isSelf(this, msg.actor)) {\n            self[msg.type](msg.channel);\n        } else {\n            user[msg.type](msg.actor, msg.channel);\n        }\n    };\n}();\n\nvar onNick = function (msg) {\n    channels.forEach(function (channel) {\n        if (channel.users.has(msg.actor)) {\n            channel.users.remove(msg.actor);\n            channel.users.add(msg.newNick);\n        }\n    });\n};\n\nmodule.exports = {\n    name: \"users\",\n    exports: {\n        users:users\n    },\n    handlers: {\n        \"join part quit\" : onLeave,\n        \"nick\" : onNick,\n        \"353\" : namesHandler\n    }\n};\n\n*/\n\nmodule.exports = {\n    init: function (tennu) {\n        return {};\n    }\n};"],"sourceRoot":"/source/"}